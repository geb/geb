plugins {
    id 'groovy'
    id 'java-library'
    id 'codenarc'
    id 'geb.base'
}

java {
    toolchain {
        languageVersion = JavaLanguageVersion.of(11)
    }
}

configurations {
    groovy

    api.extendsFrom groovy
    codenarc.extendsFrom groovy
}

codenarc.configFile = rootProject.file('gradle/codenarc/rulesets.groovy')

def codenarcTasks = tasks.withType(CodeNarc)

tasks.register('codenarc') {
    dependsOn codenarcTasks
}

codenarcTasks.configureEach {
    exclude 'GebConfig*.groovy'
}

tasks.withType(GroovyCompile).configureEach {
    groovyOptions.forkOptions.memoryMaximumSize = '256m'
}

tasks.withType(Test).configureEach {
    shouldRunAfter codenarcTasks
}